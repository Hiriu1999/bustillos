<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- TikTok Pixel Code Start (NO TOCAR) -->
  <script>
  !function (w, d, t) {
    w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];
    ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"];
    ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}; 
    for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);
    ttq.instance=function(t){for(var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e};
    ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;
      ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};
      n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;
      e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};
    ttq.load('D43RAMJC77U9LG1FU9J0');
    ttq.page();
  }(window, document, 'ttq'));
  </script>
  <!-- TikTok Pixel Code End -->

  <title>Dr. Daniel Bustillos Medrano | Reserva tu cita</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    :root {
      --bg:#0a0a0a;
      --panel:#151515;
      --gold:#f2b705;
      --gold-soft:rgba(242,183,5,.12);
      --white:#ffffff;
      --accent:#ffbb3b;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      font-family:'Montserrat',sans-serif;
      background:radial-gradient(circle at top, #1a1a1a 0%, #0a0a0a 35%, #000 100%);
      color:var(--white);
      position:relative;
      overflow-x:hidden;
    }
    .blob{
      position:fixed;
      filter:blur(120px);
      opacity:.45;
      z-index:-1;
    }
    .blob-1{top:-120px;right:-160px;width:380px;height:380px;background:rgba(242,183,5,.35);}
    .blob-2{bottom:80px;left:-140px;width:280px;height:280px;background:rgba(255,255,255,.05);}

    .container{max-width:1180px;margin:0 auto;padding:0 1.25rem;}

    header{
      position:fixed;
      top:0;left:0;right:0;
      background:rgba(0,0,0,.82);
      backdrop-filter:blur(10px);
      border-bottom:1px solid rgba(242,183,5,.12);
      z-index:99;
      transition:.15s;
    }
    header.scrolled{background:rgba(0,0,0,.96);}
    .header-content{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
      padding:.55rem 0;
    }
    .header-left{display:flex;gap:.75rem;align-items:center;}
    .logo-box{
      width:45px;height:45px;
      background:rgba(242,183,5,.05);
      border:1px solid rgba(242,183,5,.4);
      border-radius:12px;
      display:flex;align-items:center;justify-content:center;
      overflow:hidden;
    }
    .logo-box img{width:100%;height:100%;object-fit:contain;}
    .doctor-title h1{font-size:.78rem;font-weight:800;}
    .doctor-title p{font-size:.6rem;text-transform:uppercase;opacity:.75;}
    .header-btn{
      background:linear-gradient(115deg,var(--gold) 0%, #ffeaa7 100%);
      border:none;
      color:#000;
      font-weight:700;
      font-size:.67rem;
      padding:.5rem .9rem;
      border-radius:999px;
      display:flex;gap:.35rem;align-items:center;
      cursor:pointer;
      box-shadow:0 10px 30px rgba(242,183,5,.25);
      animation:pulseBtn 2.6s ease-in-out infinite;
    }

    .hero{padding:5.7rem 0 3.3rem;position:relative;}
    .hero-inner{max-width:720px;position:relative;z-index:2;}
    .hero-pill{
      display:inline-flex;
      gap:.4rem;
      align-items:center;
      background:rgba(0,0,0,.25);
      border:1px solid rgba(242,183,5,.28);
      padding:.35rem .65rem;
      border-radius:999px;
      font-size:.58rem;
      text-transform:uppercase;
      letter-spacing:.07em;
      margin-bottom:.6rem;
      backdrop-filter:blur(4px);
      animation:floatY 4.5s ease-in-out infinite;
    }
    .hero-pill i{color:var(--gold);}
    .hero-title{
      font-size:2.8rem;
      line-height:1.02;
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:-.02em;
      margin-bottom:1rem;
    }
    .hero-title span{color:var(--gold);display:block;}
    .hero-sub{
      font-size:.8rem;
      color:rgba(255,255,255,.65);
      max-width:460px;
      line-height:1.4;
    }

    .form-card{
      background:linear-gradient(160deg, #111 0%, #000 80%);
      border:1.5px solid rgba(242,183,5,.25);
      border-radius:1rem;
      padding:1.15rem 1.1rem 1.05rem;
      box-shadow:0 25px 80px rgba(0,0,0,.4);
      margin-top:1.1rem;
      animation:fadeUp .6s ease-out;
      position:relative;
      overflow:hidden;
    }
    .form-card::after{
      content:"";
      position:absolute;
      inset:-1px;
      border-radius:1rem;
      background:radial-gradient(circle, rgba(242,183,5,.22) 0%, rgba(0,0,0,0) 60%);
      pointer-events:none;
      filter:blur(18px);
      opacity:.7;
      z-index:0;
    }
    .form-card::before{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius:1rem;
      background:conic-gradient(from 180deg, rgba(242,183,5,0) 0%, rgba(242,183,5,.22) 20%, rgba(255,255,255,.08) 35%, rgba(242,183,5,.18) 55%, rgba(242,183,5,0) 78%, rgba(242,183,5,0) 100%);
      filter:blur(10px);
      opacity:.35;
      animation:ringSpin 7.5s linear infinite;
      pointer-events:none;
      z-index:0;
    }

    .form-header{text-align:center;margin-bottom:.6rem;position:relative;z-index:2;}
    .sparkles{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:1;
      opacity:.55;
      filter:blur(.1px);
    }
    .sparkles span{
      position:absolute;
      width:5px;height:5px;
      border-radius:999px;
      background:rgba(242,183,5,.85);
      box-shadow:0 0 14px rgba(242,183,5,.45);
      animation:twinkle 3.6s ease-in-out infinite;
    }
    .sparkles span:nth-child(1){top:10%;left:12%;animation-delay:.1s;transform:scale(.8)}
    .sparkles span:nth-child(2){top:18%;left:78%;animation-delay:.9s;transform:scale(.7)}
    .sparkles span:nth-child(3){top:55%;left:90%;animation-delay:1.6s;transform:scale(.55)}
    .sparkles span:nth-child(4){top:70%;left:8%; animation-delay:2.1s;transform:scale(.6)}
    .sparkles span:nth-child(5){top:84%;left:55%;animation-delay:2.7s;transform:scale(.75)}

    .form-header h2{
      font-size:1.35rem;
      font-weight:800;
      text-transform:uppercase;
      letter-spacing:-.015em;
      animation:breath 5s ease-in-out infinite;
      position:relative;
      z-index:2;
    }
    .form-header p{font-size:.7rem;color:rgba(255,255,255,.7);margin-top:.3rem;position:relative;z-index:2;}
    .form-header .badge-alerta{
      display:inline-block;
      background:rgba(242,183,5,.15);
      border:1px solid rgba(242,183,5,.55);
      color:#fff;
      font-size:.58rem;
      text-transform:uppercase;
      letter-spacing:.08em;
      padding:.3rem .6rem;
      border-radius:999px;
      margin-top:.45rem;
      animation:softGlow 4s ease-in-out infinite;
      position:relative;
      z-index:2;
    }
    .form-header .local-tag{
      display:inline-flex;
      gap:.35rem;
      align-items:center;
      background:rgba(10,10,10,0.12);
      border:1px solid rgba(242,183,5,.12);
      border-radius:999px;
      padding:.25rem .65rem;
      font-size:.54rem;
      margin-top:.4rem;
      color:rgba(255,255,255,.7);
      position:relative;
      z-index:2;
    }
    .form-group{margin-bottom:.7rem;position:relative;z-index:2;}
    label{
      display:flex;gap:.35rem;align-items:center;
      font-weight:650;
      font-size:.68rem;
      text-transform:uppercase;
      margin-bottom:.35rem;
      position:relative;
      z-index:2;
    }
    label i{color:var(--gold);}
    input[type="text"],
    input[type="tel"],
    select{
      width:100%;
      background:#0d0d0d;
      border:1px solid rgba(242,183,5,.25);
      border-radius:.6rem;
      padding:.65rem .6rem;
      color:#fff;
      font-size:.78rem;
      font-family:'Montserrat',sans-serif;
      transition:.2s all ease;
      position:relative;
      z-index:2;
    }
    input:focus,select:focus{
      outline:none;
      border-color:var(--gold);
      background:#131313;
      box-shadow:0 0 0 2px rgba(242,183,5,.12);
    }

    .promo-row{
      display:flex;
      gap:.45rem;
      flex-wrap:wrap;
      margin:.05rem 0 .45rem;
      position:relative;
      z-index:2;
    }
    .promo-chip{
      position:relative;
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      padding:.42rem .6rem;
      border-radius:999px;
      border:1px solid rgba(242,183,5,.55);
      background:linear-gradient(120deg, rgba(242,183,5,.18) 0%, rgba(0,0,0,.25) 55%, rgba(242,183,5,.12) 100%);
      color:#fff;
      font-weight:800;
      font-size:.58rem;
      text-transform:uppercase;
      letter-spacing:.07em;
      cursor:pointer;
      user-select:none;
      box-shadow:0 10px 25px rgba(242,183,5,.12);
      transition:.18s ease;
      overflow:hidden;
      z-index:2;
    }
    .promo-chip i{color:var(--gold);}
    .promo-chip::after{
      content:"";
      position:absolute;
      top:0;left:-60%;
      width:60%;
      height:100%;
      background:linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.18) 50%, rgba(255,255,255,0) 100%);
      transform:skewX(-18deg);
      animation:shine 2.6s ease-in-out infinite;
      opacity:.75;
      pointer-events:none;
    }
    .promo-chip:hover{transform:translateY(-1px); box-shadow:0 14px 30px rgba(242,183,5,.18);}
    .promo-chip.active{
      border-color:rgba(242,183,5,.98);
      background:linear-gradient(120deg, rgba(242,183,5,.42) 0%, rgba(0,0,0,.35) 55%, rgba(242,183,5,.20) 100%);
      box-shadow:0 0 0 2px rgba(242,183,5,.16), 0 18px 40px rgba(242,183,5,.18);
    }
    .promo-chip.active::before{
      content:"";
      position:absolute;
      inset:-10px;
      background:radial-gradient(circle, rgba(242,183,5,.22) 0%, rgba(0,0,0,0) 65%);
      filter:blur(10px);
      opacity:.9;
      pointer-events:none;
    }

    select.is-promo{
      border-color:rgba(242,183,5,.95);
      box-shadow:0 0 0 3px rgba(242,183,5,.16), 0 18px 45px rgba(242,183,5,.12);
      background:#101010;
    }
    .promo-note{
      margin-top:.35rem;
      font-size:.56rem;
      color:rgba(255,255,255,.68);
      display:flex;
      gap:.35rem;
      align-items:center;
      position:relative;
      z-index:2;
    }
    .promo-note i{color:var(--gold);}

    .phone-input{display:flex;position:relative;z-index:2;}
    .phone-prefix{
      background:var(--gold);
      color:#000;
      font-weight:800;
      padding:.65rem .55rem;
      border-radius:.6rem 0 0 .6rem;
      font-size:.7rem;
      display:flex;align-items:center;
    }
    .phone-input input{border-radius:0 .6rem .6rem 0;}

    .checkbox-group{
      background:rgba(0,0,0,.25);
      border:1px solid rgba(242,183,5,.25);
      border-left:4px solid var(--gold);
      border-radius:.6rem;
      padding:.55rem .6rem;
      display:flex;gap:.45rem;align-items:flex-start;
      position:relative;
      z-index:2;
    }
    .checkbox-group label{
      text-transform:none;
      font-size:.62rem;
      margin-bottom:0;
      line-height:1.25;
    }

    .btn-submit{
      width:100%;
      background:linear-gradient(120deg,var(--gold) 0%, #fff2bd 58%, #f2b705 100%);
      color:#000;
      border:none;
      border-radius:.65rem;
      padding:.7rem .6rem;
      font-weight:800;
      text-transform:uppercase;
      font-size:.78rem;
      letter-spacing:.04em;
      cursor:pointer;
      display:flex;gap:.35rem;align-items:center;justify-content:center;
      box-shadow:0 15px 30px rgba(242,183,5,.35);
      transition:.15s;
      animation:pulseBtn 3s ease-in-out infinite;
      position:relative;
      z-index:2;
    }
    .btn-submit[disabled]{opacity:.6;cursor:not-allowed;animation:none;}
    .btn-submit:hover{transform:translateY(-1px);}
    .privacy-text{
      text-align:center;
      font-size:.55rem;
      margin-top:.4rem;
      color:rgba(255,255,255,.55);
      display:flex;gap:.3rem;align-items:center;justify-content:center;
      position:relative;z-index:2;
    }

    .mini-trust{
      display:flex;
      gap:.5rem;
      margin-top:.6rem;
      flex-wrap:wrap;
      position:relative;
      z-index:2;
    }
    .mini-trust-item{
      background:rgba(0,0,0,.12);
      border:1px solid rgba(242,183,5,.06);
      border-radius:.6rem;
      padding:.4rem .6rem;
      display:flex;
      gap:.35rem;
      align-items:center;
      font-size:.55rem;
      color:rgba(255,255,255,.7);
    }
    .mini-trust-item i{color:var(--gold);}

    .doctor-section{background:#000;padding:2.1rem 0 2.8rem;}
    .doctor-grid{
      display:grid;
      grid-template-columns:1fr .45fr;
      gap:1.2rem;
      align-items:center;
    }
    @media(max-width:900px){.doctor-grid{grid-template-columns:1fr;}}
    .doctor-box{
      background:linear-gradient(90deg,rgba(242,183,5,.05) 0%, rgba(0,0,0,0) 100%);
      border:1px solid rgba(242,183,5,.04);
      border-radius:1rem;
      padding:1.1rem 1rem;
    }
    .doctor-box h2{font-size:1.05rem;font-weight:800;margin-bottom:.45rem;}
    .doctor-box p{font-size:.68rem;max-width:650px;color:rgba(255,255,255,.75);line-height:1.4;}
    .doctor-photo{
      max-width:240px;
      justify-self:center;
      background:linear-gradient(180deg,rgba(242,183,5,.25) 0%, rgba(0,0,0,0) 40%);
      border-radius:1rem;
      padding:.4rem;
    }
    .doctor-photo img{
      width:100%;
      display:block;
      border-radius:.8rem;
      background:#000;
      object-fit:cover;
    }

    .map-section{background:#000;padding:0 0 2.5rem;}
    .map-container{border-radius:1rem;overflow:hidden;height:320px;border:1px solid rgba(242,183,5,.05);}
    #map{height:100%;width:100%}

    footer{background:#000;padding:1.3rem 0 2.3rem;text-align:center;font-size:.6rem;color:rgba(255,255,255,.5);}

    @keyframes pulseBtn {0%,100%{transform:scale(1);}50%{transform:scale(1.02);}}
    @keyframes fadeUp {from{opacity:0;transform:translateY(14px);}to{opacity:1;transform:translateY(0);}}
    @keyframes softGlow {0%,100%{box-shadow:0 0 0 rgba(242,183,5,0);}50%{box-shadow:0 0 18px rgba(242,183,5,.35);}}
    @keyframes floatY {0%,100%{transform:translateY(0);}50%{transform:translateY(-6px);}}
    @keyframes breath {0%,100%{transform:scale(1);}50%{transform:scale(1.01);}}
    @keyframes shine {0%{transform:translateX(-60%) skewX(-18deg);}55%{transform:translateX(160%) skewX(-18deg);}100%{transform:translateX(160%) skewX(-18deg);}}
    @keyframes ringSpin {to{transform:rotate(360deg);}}
    @keyframes twinkle {
      0%,100%{opacity:.15; transform:scale(.6);}
      50%{opacity:.95; transform:scale(1.05);}
    }

    @media(max-width:680px){
      .hero-title{font-size:2.35rem;}
      .hero{padding-top:5.3rem;}
      .header-btn{display:none;}
      .form-card{margin-top:.9rem;}
    }
  </style>
</head>
<body>
  <div class="blob blob-1"></div>
  <div class="blob blob-2"></div>

  <!-- Meta Pixel (noscript) -->
  <noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=775257788680673&ev=PageView&noscript=1"/></noscript>

  <!-- HEADER -->
  <header id="header">
    <div class="container">
      <div class="header-content">
        <div class="header-left">
          <div class="logo-box">
            <img src="logos.jpg" alt="Logo Dr. Daniel Bustillos">
          </div>
          <div class="doctor-title">
            <h1>DR. DANIEL BUSTILLOS MEDRANO</h1>
            <p>Cirug√≠a general, abdominal y digestiva laparosc√≥pica</p>
          </div>
        </div>
        <button class="header-btn" onclick="document.getElementById('citaForm').scrollIntoView({behavior:'smooth'})">
          Reservar cita
          <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero" id="inicio">
    <div class="container">
      <div class="hero-inner">
        <div class="hero-pill">
          <i class="fas fa-location-dot"></i>
          Atenci√≥n en Puerto Maldonado
        </div>
        <h2 class="hero-title">RESERVA TU CITA <span>CON EL DOCTOR HOY</span></h2>
        <p class="hero-sub">Completa tus datos y te confirmamos por WhatsApp. Citas reales, cupos limitados por d√≠a.</p>

        <div class="form-card">
          <div class="form-header">
            <div class="sparkles" aria-hidden="true">
              <span></span><span></span><span></span><span></span><span></span>
            </div>
            <h2>Agenda tu consulta</h2>
            <p>Completa todos tus datos para confirmarte por WhatsApp ‚úÖ</p>
            <span class="badge-alerta">Cupos limitados</span>
            <div class="local-tag">
              <i class="fas fa-city"></i> PUERTO MALDONADO
            </div>
          </div>

          <form id="citaForm">
            <div class="form-group">
              <label for="nombre"><i class="fas fa-user"></i> Nombre completo *</label>
              <input type="text" id="nombre" name="nombre" placeholder="Ej: Juan P√©rez" required autocomplete="name">
            </div>

            <div class="form-group">
              <label for="whatsapp"><i class="fab fa-whatsapp"></i> WhatsApp activo *</label>
              <div class="phone-input">
                <div class="phone-prefix">+51</div>
                <input type="tel" id="whatsapp" name="whatsapp" placeholder="940 347 653" required inputmode="numeric" autocomplete="tel-national">
              </div>
            </div>

            <div class="form-group">
              <label for="consulta"><i class="fas fa-comment-medical"></i> ¬øQu√© necesitas? *</label>

              <div class="promo-row" aria-label="Opciones en promoci√≥n">
                <div class="promo-chip" role="button" tabindex="0" data-set-consulta="manga_gastrica">
                  <i class="fas fa-star"></i> Manga g√°strica <span style="opacity:.85;">PROMO</span>
                </div>
                <div class="promo-chip" role="button" tabindex="0" data-set-consulta="balon_gastrico">
                  <i class="fas fa-fire"></i> Bal√≥n g√°strico <span style="opacity:.85;">PROMO</span>
                </div>
              </div>

              <select id="consulta" name="consulta" required>
                <option value="">Selecciona una opci√≥n</option>
                <option value="manga_gastrica">‚≠ê Manga g√°strica ‚Äî PROMO</option>
                <option value="balon_gastrico">üî• Bal√≥n g√°strico ‚Äî PROMO</option>
                <option value="cirugia_vesicula">Cirug√≠a de ves√≠cula</option>
                <option value="cirugia_apendice">Cirug√≠a de ap√©ndice</option>
                <option value="cirugia_hernia">Cirug√≠a de hernia</option>
                <option value="hemorroides">Hemorroides / F√≠stulas</option>
                <option value="curaciones">Curaciones / Retiro de puntos</option>
                <option value="segunda_opinion">Segunda opini√≥n</option>
                <option value="otro">Otro</option>
              </select>

              <div class="promo-note" id="promoNote" style="display:none;">
                <i class="fas fa-badge-check"></i>
                <span><strong>Selecci√≥n PROMO:</strong> prioridad de atenci√≥n seg√∫n cupos del d√≠a.</span>
              </div>
            </div>

            <div class="form-group">
              <div class="checkbox-group">
                <input type="checkbox" id="compromiso" name="compromiso" required>
                <label for="compromiso">
                  Confirmo que es una cita real y autorizo que me contacten por WhatsApp para coordinar.
                </label>
              </div>
            </div>

            <button type="submit" class="btn-submit">
              <i class="fas fa-paper-plane"></i> Reservar cita ahora
            </button>
          </form>

          <div class="mini-trust">
            <div class="mini-trust-item">
              <i class="fas fa-bolt"></i> Respuesta en menos de 30 min
            </div>
            <div class="mini-trust-item">
              <i class="fas fa-user-shield"></i> Datos seguros
            </div>
            <div class="mini-trust-item">
              <i class="fas fa-hospital-user"></i> Atenci√≥n especializada
            </div>
          </div>

          <p class="privacy-text">
            <i class="fas fa-shield-alt"></i> Tus datos son privados.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- DOCTOR -->
  <section class="doctor-section" id="doctor">
    <div class="container">
      <div class="doctor-grid">
        <div class="doctor-box">
          <h2>¬øQui√©n te atender√°?</h2>
          <p>
            El Dr. Daniel Bustillos Medrano es especialista en cirug√≠a general, abdominal y digestiva laparosc√≥pica.
            Completa el formulario y te confirmamos la cita seg√∫n disponibilidad en Puerto Maldonado.
          </p>
        </div>
        <div class="doctor-photo">
          <img src="DOCTOR.png" alt="Dr. Daniel Bustillos">
        </div>
      </div>
    </div>
  </section>

  <!-- MAPA -->
  <section class="map-section" id="mapa">
    <div class="container">
      <div class="map-container" id="map"></div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer id="contacto">
    <div class="container">
      &copy; 2025 Dr. Daniel Bustillos Medrano. P√°gina de reservas.
    </div>
  </footer>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Script final -->
  <script>
  document.addEventListener('DOMContentLoaded', function () {
    try {
      const form   = document.getElementById('citaForm');
      const header = document.getElementById('header');

      const MAKE_WEBHOOK_URL = 'https://hook.us2.make.com/2th4a8f047rudlij7idhtecnd8yb790j';

      // ‚úÖ WhatsApp destino (E.164 Per√∫) = 51992944613
      const WHATSAPP_PHONE   = '51992944613';

      // ‚úÖ FIX CR√çTICO: env√≠o robusto para navegadores in-app (Meta/TikTok)
      function sendToMake(url, payload) {
        const body = JSON.stringify(payload);

        // 1) Intentar sendBeacon (mejor para cuando hay redirecciones/unload)
        if (navigator.sendBeacon) {
          try {
            const blob = new Blob([body], { type: 'application/json' });
            const ok = navigator.sendBeacon(url, blob);
            if (ok) return Promise.resolve(true); // enviado ‚úÖ
          } catch (e) {}
        }

        // 2) Fallback: fetch (no-cors) + keepalive
        return fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body,
          keepalive: true,
          mode: 'no-cors'
        })
        .then(() => true)
        .catch(() => false);
      }

      function validateForm() {
        const nombre     = document.getElementById('nombre')?.value.trim();
        const whatsapp   = document.getElementById('whatsapp')?.value.trim();
        const consulta   = document.getElementById('consulta')?.value;
        const compromiso = document.getElementById('compromiso')?.checked;

        if (!nombre) { alert('Ingresa tu nombre completo.'); return false; }

        const clean = (whatsapp || '').replace(/\D/g, '');
        if (!clean || clean.length < 8) { alert('Ingresa un WhatsApp v√°lido.'); return false; }

        if (!consulta) { alert('Selecciona el motivo de tu consulta.'); return false; }

        if (!compromiso) { alert('Debes aceptar el compromiso para reservar.'); return false; }

        return true;
      }

      function ttqSafeTrack(name, props){
        try {
          if (window.ttq && typeof ttq.track === 'function') {
            ttq.track(name, props || {});
          }
        } catch (e) {}
      }
      function ttqSafeIdentify(props){
        try {
          if (window.ttq && typeof ttq.identify === 'function') {
            ttq.identify(props || {});
          }
        } catch (e) {}
      }

      // header scroll
      try {
        window.addEventListener('scroll', () => {
          if (!header) return;
          if (window.scrollY > 40) header.classList.add('scrolled');
          else header.classList.remove('scrolled');
        });
      } catch (e) {}

      // mapa
      try {
        if (window.L && document.getElementById('map')) {
          const map = L.map('map').setView([-12.6, -69.1833], 15);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
          }).addTo(map);
          L.marker([-12.6, -69.1833]).addTo(map).bindPopup(
            '<div style="text-align:center;"><h3 style="margin:0 0 10px;color:#0f172a;">Consultorio Dr. Bustillos</h3><p style="margin:5px 0;">Av. Leon Velarde 1030</p><p style="margin:5px 0;">Puerto Maldonado</p></div>'
          ).openPopup();
        }
      } catch (e) {}

      // evento de vista
      ttqSafeTrack('ViewContent', {
        contents: [{
          content_id: 'landing_drbustillos',
          content_type: 'product',
          content_name: 'Reserva de Cita'
        }],
        value: 0,
        currency: 'PEN'
      });

      // UI/efecto promo
      function syncPromoUI() {
        const consultaEl = document.getElementById('consulta');
        const promoNote  = document.getElementById('promoNote');
        const chips      = document.querySelectorAll('.promo-chip');
        if (!consultaEl) return;

        const isPromo = (consultaEl.value === 'manga_gastrica' || consultaEl.value === 'balon_gastrico');
        consultaEl.classList.toggle('is-promo', isPromo);
        if (promoNote) promoNote.style.display = isPromo ? 'flex' : 'none';

        chips.forEach(ch => {
          const v = ch.getAttribute('data-set-consulta');
          ch.classList.toggle('active', v === consultaEl.value);
        });
      }

      // cambio de motivo
      try {
        const consultaEl = document.getElementById('consulta');
        if (consultaEl) {
          consultaEl.addEventListener('change', function(){
            const label = this.options[this.selectedIndex]?.text || '';
            ttqSafeTrack('Search', {
              contents: [{
                content_id: 'motivo_consulta',
                content_type: 'product',
                content_name: label
              }],
              value: 0,
              currency: 'PEN',
              search_string: label
            });
            syncPromoUI();
          });
          syncPromoUI();
        }

        // chips clicables
        const chips = document.querySelectorAll('.promo-chip');
        chips.forEach(chip => {
          const setVal = () => {
            const v = chip.getAttribute('data-set-consulta');
            const select = document.getElementById('consulta');
            if (!select || !v) return;
            select.value = v;
            select.dispatchEvent(new Event('change', { bubbles: true }));
            select.focus();
          };
          chip.addEventListener('click', setVal);
          chip.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); setVal(); }
          });
        });

      } catch(e){}

      // click en bot√≥n
      try {
        const submitBtn = document.querySelector('.btn-submit');
        if (submitBtn) {
          submitBtn.addEventListener('click', function(){
            ttqSafeTrack('ClickButton', {
              contents:[{
                content_id:'reservar_cita_btn',
                content_type:'product',
                content_name:'Reservar Cita Ahora'
              }],
              value:0,
              currency:'PEN'
            });
          });
        }
      } catch(e){}

      if (form) {
        form.addEventListener('submit', async function(e){
          e.preventDefault();
          if (!validateForm()) return;

          const submitBtn = document.querySelector('.btn-submit');
          if (submitBtn) submitBtn.disabled = true;

          const consultaEl     = document.getElementById('consulta');
          const consulta_value = consultaEl.value;
          const consulta_label = consultaEl.options[consultaEl.selectedIndex].text;

          const rawPhone    = document.getElementById('whatsapp').value;
          const phoneDigits = (rawPhone || '').replace(/\D/g, '');

          const payload = {
            nombre: document.getElementById('nombre').value.trim(),
            whatsapp: `+51 ${phoneDigits}`,
            whatsapp_digits: phoneDigits,
            consulta_value,
            consulta_label,
            compromiso: document.getElementById('compromiso').checked,
            timestamp_iso: new Date().toISOString(),
            fuente: 'landing_drbustillos',
            page_url: window.location.href,
            user_agent: navigator.userAgent
          };

          // 1) enviar al CRM (Make) y esperar un poco (m√°x 1.8s) para evitar corte por redirecci√≥n
          const sendPromise = sendToMake(MAKE_WEBHOOK_URL, payload);
          await Promise.race([
            sendPromise,
            new Promise(res => setTimeout(() => res(false), 1800))
          ]);

          // 2) disparos de pixel
          try {
            const e164 = `+51${phoneDigits}`;
            ttqSafeIdentify({ phone_number: e164 });

            ttqSafeTrack('SubmitForm', {
              contents: [{
                content_id: 'lead_cita',
                content_type: 'product',
                content_name: consulta_label
              }],
              value: 0,
              currency: 'PEN'
            });

            ttqSafeTrack('CompleteRegistration', {
              contents: [{
                content_id: 'lead_cita',
                content_type: 'product',
                content_name: consulta_label
              }],
              value: 0,
              currency: 'PEN'
            });
          } catch(e){}

          // 3) redirigir al WhatsApp destino (ASISTENTE)
          const msg =
            `*Nueva solicitud de cita*\n\n` +
            `üë§ *Paciente:* ${payload.nombre}\n` +
            `üì± *WhatsApp:* +51 ${phoneDigits}\n` +
            `üìù *Motivo:* ${consulta_label}\n` +
            `‚úÖ *Compromiso:* ${payload.compromiso ? 'S√≠, asistir√©' : 'No indicado'}\n\n` +
            `Buen d√≠a üëã Vengo del formulario y estoy interesado(a). ¬øMe podr√≠a indicar por favor el d√≠a y la hora disponibles?`;

          const waURL = `https://api.whatsapp.com/send?phone=${WHATSAPP_PHONE}&text=${encodeURIComponent(msg)}`;
          window.location.href = waURL;

          if (submitBtn) submitBtn.disabled = false;
        });
      }

    } catch (err) {
      console.error('Error inicializando la landing:', err);
    }
  });
  </script>
</body>
</html>
